/* jQuery UI Virtual Keyboard Autocomplete v1.5 for Keyboard v1.18+ only (3/1/2014)
 * By Rob Garrison ~ MIT license ~ https://github.com/Mottie/Keyboard */
;(function(d){d.fn.addAutocomplete=function(){return this.each(function(){var a=d(this).data("keyboard");a&&(a.autocomplete_new_version=function(a){a[0]=parseInt(a[0],10);return 1<a[0]||1===a[0]&&9<=parseInt(a[1],10)}(d.ui.version.split(".")),a.autocomplete_init=function(b,c,d){a.options.alwaysOpen&&a.isVisible()&&a.autocomplete_setup();a.$el.bind("visible.keyboard",function(){a.autocomplete_setup()}).bind("change.keyboard",function(){a.hasAutocomplete&&a.isVisible()&&a.$el.val(a.$preview.val()).trigger("keydown.autocomplete")}).bind("hidden.keyboard", function(b){a.$el.autocomplete("close")}).bind("autocompleteopen",function(b,c){a.hasAutocomplete&&a.$autocomplete.menu.element.position({of:a.$keyboard,my:"right top",at:"left top",collision:"flip"})}).bind("autocompleteselect",function(b,c){var d=c.item.value;a.hasAutocomplete&&""!==d&&(a.$preview.val(d).focus(),a.lastCaret={start:d.length,end:d.length})})},a.autocomplete_setup=function(){a.$autocomplete=a.$el.data("autocomplete")||a.$el.data("uiAutocomplete");a.hasAutocomplete="undefined"===typeof a.$autocomplete? !1:a.$autocomplete.options.disabled?!1:!0;a.hasAutocomplete&&(a.$preview.bind("keydown",function(b){return a.autocomplete_input(b)}),a.$allKeys.bind("mouseup mousedown mouseleave touchstart touchend touchcancel",function(b){a.autocomplete_input(b)}))},a.autocomplete_input=function(b){var c;c=d.ui.keyCode;switch(b.keyCode){case c.PAGE_UP:a.$autocomplete._move("previousPage",b);b.preventDefault();break;case c.PAGE_DOWN:a.$autocomplete._move("nextPage",b);b.preventDefault();break;case c.UP:a.$autocomplete._move("previous", b);b.preventDefault();break;case c.DOWN:a.$autocomplete._move("next",b);b.preventDefault();break;case c.ENTER:case c.NUMPAD_ENTER:c=a.$autocomplete.menu.element.find("#ui-active-menuitem,.ui-state-focus").text()||"";""!==c&&a.$preview.val(c);a.autocomplete_new_version&&a.$autocomplete.menu.select(b);break;default:clearTimeout(a.$autocomplete.searching),a.$autocomplete.searching=setTimeout(function(){a.$autocomplete.term!==a.$autocomplete.element.val()&&(a.$autocomplete.selectedItem=null,a.$autocomplete.search(null, b))},a.$autocomplete.options.delay)}},a.origEscClose=a.escClose,a.escClose=function(b){a.hasAutocomplete&&("ui-active-menuitem"===b.target.id||d(b.target).closest("ul").hasClass("ui-autocomplete"))||a.origEscClose(b)},a.autocomplete_init())})}})(jQuery);
