/* jQuery UI Virtual Keyboard Navigation v1.4 for Keyboard v1.18+ only (updated 3/1/2014)
 * By Rob Garrison ~ MIT license ~ https://github.com/Mottie/Keyboard */
;(function(e){e.keyboard=e.keyboard||{};e.keyboard.navigationKeys={toggle:112,enter:13,pageup:33,pagedown:34,end:35,home:36,left:37,up:38,right:39,down:40,caretrt:45,caretlt:46};e.fn.addNavigation=function(n){return this.each(function(){var c,k,a=e(this).data("keyboard");k={position:[0,0],toggleMode:!1,focusClass:"hasFocus"};a&&(a.navigation_options=c=e.extend({},k,n),a.navigation_keys=k=e.extend({},e.keyboard.navigationKeys),a.saveNav=[a.options.tabNavigation,a.options.enterNavigation],a.allNavKeys= e.map(k,function(a,b){return a}),a.navigation_init=function(){a.$keyboard.toggleClass(c.focusClass,c.toggleMode).find(".ui-keyboard-keyset:visible").find('.ui-keyboard-button[data-pos="'+c.position[0]+","+c.position[1]+'"]').addClass("ui-state-hover");a.$preview.unbind("keydown.keyboardNav").bind("keydown.keyboardNav",function(c){return a.checkKeys(c.which)})},a.checkKeys=function(h,b){if("undefined"!==typeof h){var d=a.navigation_keys;if(h===d.toggle||b)c.toggleMode=b?!1:!c.toggleMode,a.options.tabNavigation= c.toggleMode?!1:a.saveNav[0],a.options.enterNavigation=c.toggleMode?!1:a.saveNav[1];a.$keyboard.toggleClass(c.focusClass,c.toggleMode);if(c.toggleMode&&h===d.enter)return a.$keyboard.find(".ui-keyboard-keyset:visible").find('.ui-keyboard-button[data-pos="'+c.position[0]+","+c.position[1]+'"]').trigger("repeater.keyboard"),!1;if(c.toggleMode&&0<=e.inArray(h,a.allNavKeys))return a.navigateKeys(h),!1}},a.navigateKeys=function(h,b,d){d=d||c.position[1];b=b||c.position[0];var e=a.$keyboard.find(".ui-keyboard-keyset:visible"), k=e.find(".ui-keyboard-button-endrow").length-1,l=e.find('.ui-keyboard-button[data-pos^="'+b+',"]').length-1,g=a.lastCaret,m=a.$preview.val().length,f=a.navigation_keys;switch(h){case f.pageup:b=0;break;case f.pagedown:b=k;break;case f.end:d=l;break;case f.home:d=0;break;case f.left:d+=0<d?-1:0;break;case f.up:b+=0<b?-1:0;break;case f.right:d+=1;break;case f.down:b+=b+1>k?0:1;break;case f.caretRt:g.start++;break;case f.caretLt:g.start--}if(h===f.caretRt||h===f.caretLt)g.start=0>g.start?0:g.start> m?m:g.start,g.end=g.start,a.lastCaret=g,a.$preview.focus().caret(g.start,g.start);l=e.find('.ui-keyboard-button[data-pos^="'+b+',"]').length-1;d>l&&(d=l);e.find(".ui-state-hover").removeClass("ui-state-hover");e.find('.ui-keyboard-button[data-pos="'+b+","+d+'"]').addClass("ui-state-hover");c.position=[b,d]},a.options.alwaysOpen&&a.isVisible&&(a.$keyboard.find(".ui-state-hover").removeClass("ui-state-hover"),a.navigation_init()),a.$el.bind("visible.keyboard",function(c){a.$keyboard.find(".ui-state-hover").removeClass("ui-state-hover"); a.navigation_init()}).bind("inactive.keyboard hidden.keyboard",function(c){a.checkKeys(c.which,!0)}).bind("navigate navigateTo",function(c,b,d){b=isNaN(b)?b.toLowerCase():b;a.navigation_keys.hasOwnProperty(b)?a.checkKeys(a.navigation_keys[b]):a.navigateKeys(null,b,d)}))})}})(jQuery);
