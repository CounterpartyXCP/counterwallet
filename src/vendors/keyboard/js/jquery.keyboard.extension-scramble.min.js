/* jQuery UI Virtual Keyboard Scramble Extension v1.1 for Keyboard v1.18+ (updated 3/1/2014)
 * By Rob Garrison ~ MIT license ~ https://github.com/Mottie/Keyboard */
;(function(b){b.keyboard=b.keyboard||{};b.fn.addScramble=function(s){var t={targetKeys:/[a-z\d]/i,byRow:!0,randomizeOnce:!0};return this.each(function(){var h,a=b(this).data("keyboard");a&&(h=a.scramble_options=b.extend({},t,s),a.scramble_setup=function(f){var r,k,e,c,p,l,g,n,q,m,d;r=f.find(".ui-keyboard-keyset");if(f.length){for(k=0;k<r.length;k++)if(e=r.eq(k),g=0,d=[],q=[],n=[],m=[],e.children("button, span, br").each(function(){"BR"===this.tagName?(h.byRow?(d.push(this),q.push(!1),m[g]=d,n[g]=q, d=[],q=[]):(m[g]=this,n[g]=!1),g++):(l=b(this).attr("data-value")||"",l=1===l.length&&h.targetKeys.test(l)?l:!1,h.byRow?(d.push(this),q.push(l)):(m[g]=this,n[g]=l,g++))}),e.find(".ui-keyboard-button-endrow").remove(),h.byRow)for(p=0;p<m.length;p++)for(d=a.shuffle(m[p],n[p]),c=0;c<d.length;c++)e.append(d[c]);else for(d=a.shuffle(m,n),c=0;c<d.length;c++)e.append(d[c]);return f}},a.shuffle=function(a,b){for(var k,e,c=a.length;0<c;)e=Math.floor(Math.random()*c),!1===b[c-1]&&c--,!1!==b[c-1]&&!1!==b[e]&& (c--,k=a[c],a[c]=a[e],a[e]=k);return a},a.options.create=function(){var f=a.options.layout;b.keyboard.builtLayouts[f]={mappedKeys:{},acceptedKeys:[],$keyboard:null};"undefined"===typeof b.keyboard.builtLayouts[a.orig_layout]&&(a.layout=a.options.layout=a.orig_layout,a.buildKeyboard(),a.layout=a.options.layout=f);b.keyboard.builtLayouts[f]=b.extend({},b.keyboard.builtLayouts[a.orig_layout]);h.randomizeOnce&&(b.keyboard.builtLayouts[f].$keyboard=a.scramble_setup(b.keyboard.builtLayouts[a.orig_layout].$keyboard.clone())); a.$keyboard=b.keyboard.builtLayouts[f].$keyboard;h.randomizeOnce||a.$el.bind("beforeVisible.keyboard",function(a,b){b.$keyboard=b.scramble_setup(b.$keyboard)})},a.orig_layout=a.options.layout,a.options.layout="scrambled"+Math.round(1E4*Math.random()))})}})(jQuery);
