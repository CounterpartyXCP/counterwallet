/* jQuery UI Virtual Keyboard Typing Simulator v1.4 for Keyboard v1.18+ only (3/1/2014)
 * By Rob Garrison ~ MIT license ~ https://github.com/Mottie/Keyboard */
;(function(g){g.fn.addTyping=function(k){var l={showTyping:!0,delay:250};return this.each(function(){var a=g(this).data("keyboard");a&&(a.typing_options=g.extend({},l,k),a.typing_keymap={" ":"space",'"':"34","'":"39","&nbsp;":"space","\b":"bksp","\n":"Enter","\r":"Enter","\t":"tab"},a.typing_xref={8:"bksp",9:"tab",13:"enter",32:"space"},a.typing_event=!1,a.typing_setup=function(){(a.$preview?a.$preview:a.$el).bind("keyup.keyboard",function(b){37<=b.which&&40>=b.which||(16===b.which&&(a.shiftActive= !1),18===b.which&&(a.altActive=!1),16!==b.which&&18!==b.which)||(a.showKeySet(),setTimeout(function(){a.$preview.focus()},200))}).bind("keydown.keyboard",function(b){b.temp=!1;16===b.which&&(b.temp=a.shiftActive?!1:!0,a.shiftActive=!0);18===b.which&&(b.temp=a.altActive?!1:!0,a.altActive=!0);b.temp&&(a.showKeySet(),a.$preview.focus());a.typing_event=!0;8!==b.which&&9!==b.which||a.typeIn("",a.typing_options.delay||250,function(){a.typing_event=!1},b)}).bind("keypress.keyboard",function(b){a.typing_event&& !a.options.lockInput&&a.typeIn("",a.typing_options.delay||250,function(){a.typing_event=!1},b)})},a.typeIn=function(b,e,f,c){if(a.isVisible()){var d=a.typing_options,h=g.keyboard.builtLayouts[a.layout].mappedKeys;!0!==a.typing_options.init&&(d.init=!0,d.text=b,d.len=b.length,d.delay=e||300,d.current=0,d.callback=f);b=d.text.substring(d.current,++d.current);e=a.$keyboard.find(".ui-keyboard-keyset");f='.ui-keyboard-button[data-value="'+(a.typing_keymap.hasOwnProperty(b)?a.typing_keymap[b]:b)+'"]';a.typing_event&& c&&(a.typing_xref.hasOwnProperty(c.keyCode||c.which)?f=".ui-keyboard-"+a.typing_xref[c.keyCode||c.which]:(f=String.fromCharCode(c.charCode||c.which),f=h.hasOwnProperty(f)?'.ui-keyboard-button[data-value="'+h[f]+'"]':".ui-keyboard-"+(c.charCode||c.which)));c=e.filter(":visible").find(f);c.length?a.typing_simulateKey(c,b):(a.typing_event?c=e.find(f):(c=a.typing_keymap.hasOwnProperty(b)?a.typing_keymap[b]:b.charCodeAt(0),"bksp"===c&&(b=c),c=e.find(".ui-keyboard-"+c)),e=c.closest(".ui-keyboard-keyset"), e.attr("name")?(e=e.attr("name"),a.shiftActive=/shift/.test(e),a.altActive=/alt/.test(e),a.metaActive=a.lastKeyset[2]=e.match(/meta\d+/)||!1,a.showKeySet({name:a.metaActive}),a.typing_simulateKey(c,b)):a.typing_event||(a.insertText(b),a.checkCombos()));d.current<d.len?a.isVisible()&&setTimeout(function(){a.typeIn()},d.delay):(d.init=!1,g.isFunction(d.callback)&&setTimeout(function(){d.callback(a)},d.delay))}else a.typing_options.init=!1,clearTimeout(a.typing_timer)},a.typing_simulateKey=function(b, e){var f=b.length;f&&b.filter(":visible").trigger("mouseenter.keyboard");a.typing_timer=setTimeout(function(){f&&setTimeout(function(){b.trigger("mouseleave.keyboard")},a.typing_options.delay/3);a.isVisible()&&!a.typing_event&&(a.insertText(e),a.checkCombos())},a.typing_options.delay/3)},a.typing_options.showTyping&&(a.options.alwaysOpen&&a.isVisible()&&a.typing_setup(),a.$el.bind("visible.keyboard",function(){a.typing_setup()})))})}})(jQuery);
