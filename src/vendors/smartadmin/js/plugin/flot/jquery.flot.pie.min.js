(function(c){var e=10;var a=0.95;function d(v){var h=null,A=null,m=null,s=null,n=null,f=false,u=null;var i=[];v.hooks.processOptions.push(function(C,B){if(B.series.pie.show){B.grid.show=false;if(B.series.pie.label.show=="auto"){if(B.legend.show){B.series.pie.label.show=false}else{B.series.pie.label.show=true}}if(B.series.pie.radius=="auto"){if(B.series.pie.label.show){B.series.pie.radius=3/4}else{B.series.pie.radius=1}}if(B.series.pie.tilt>1){B.series.pie.tilt=1}else{if(B.series.pie.tilt<0){B.series.pie.tilt=0}}}});v.hooks.bindEvents.push(function(D,B){var C=D.getOptions();if(C.series.pie.show){if(C.grid.hoverable){B.unbind("mousemove").mousemove(r)}if(C.grid.clickable){B.unbind("click").click(k)}}});v.hooks.processDatapoints.push(function(F,C,D,E){var B=F.getOptions();if(B.series.pie.show){w(F,C,D,E)}});v.hooks.drawOverlay.push(function(C,D){var B=C.getOptions();if(B.series.pie.show){x(C,D)}});v.hooks.draw.push(function(D,C){var B=D.getOptions();if(B.series.pie.show){o(D,C)}});function w(D,B,C){if(!f){f=true;h=D.getCanvas();A=c(h).parent();b=D.getOptions();D.setData(z(D.getData()))}}function z(G){var E=0,D=0,I=0,B=b.series.pie.combine.color,H=[];for(var C=0;C<G.length;++C){var F=G[C].data;if(c.isArray(F)){if(c.isNumeric(F[1])){F[1]=+F[1]}else{F[1]=0}}else{if(c.isNumeric(F)){F=[1,+F]}else{F=[1,0]}}G[C].data=[F]}for(var C=0;C<G.length;++C){E+=G[C].data[0][1]}for(var C=0;C<G.length;++C){var F=G[C].data[0][1];if(F/E<=b.series.pie.combine.threshold){D+=F;I++;if(!B){B=G[C].color}}}for(var C=0;C<G.length;++C){var F=G[C].data[0][1];if(I<2||F/E>b.series.pie.combine.threshold){H.push({data:[[1,F]],color:G[C].color,label:G[C].label,angle:F*Math.PI*2/E,percent:F/(E/100)})}}if(I>1){H.push({data:[[1,D]],color:B,label:b.series.pie.combine.label,angle:D*Math.PI*2/E,percent:D/(E/100)})}return H}function o(G,J){if(!A){return}var C=G.getPlaceholder().width(),E=G.getPlaceholder().height(),I=A.children().filter(".legend").children().width()||0;u=J;f=false;m=Math.min(C,E/b.series.pie.tilt)/2;n=E/2+b.series.pie.offset.top;s=C/2;if(b.series.pie.offset.left=="auto"){if(b.legend.position.match("w")){s+=I/2}else{s-=I/2}}else{s+=b.series.pie.offset.left}if(s<m){s=m}else{if(s>C-m){s=C-m}}var H=G.getData(),K=0;do{if(K>0){m*=a}K+=1;F();if(b.series.pie.tilt<=0.8){D()}}while(!B()&&K<e);if(K>=e){F();A.prepend("<div class='error'>Could not draw pie with labels contained inside canvas</div>")}if(G.setSeries&&G.insertLegend){G.setSeries(H);G.insertLegend()}function F(){u.clearRect(0,0,C,E);A.children().filter(".pieLabel, .pieLabelBackground").remove()}function D(){var Q=b.series.pie.shadow.left;var P=b.series.pie.shadow.top;var N=10;var O=b.series.pie.shadow.alpha;var L=b.series.pie.radius>1?b.series.pie.radius:m*b.series.pie.radius;if(L>=C/2-Q||L*b.series.pie.tilt>=E/2-P||L<=N){return}u.save();u.translate(Q,P);u.globalAlpha=O;u.fillStyle="#000";u.translate(s,n);u.scale(1,b.series.pie.tilt);for(var M=1;M<=N;M++){u.beginPath();u.arc(0,0,L,0,Math.PI*2,false);u.fill();L-=M}u.restore()}function B(){var O=Math.PI*b.series.pie.startAngle;var L=b.series.pie.radius>1?b.series.pie.radius:m*b.series.pie.radius;u.save();u.translate(s,n);u.scale(1,b.series.pie.tilt);u.save();var Q=O;for(var N=0;N<H.length;++N){H[N].startAngle=Q;P(H[N].angle,H[N].color,true)}u.restore();if(b.series.pie.stroke.width>0){u.save();u.lineWidth=b.series.pie.stroke.width;Q=O;for(var N=0;N<H.length;++N){P(H[N].angle,b.series.pie.stroke.color,false)}u.restore()}y(u);u.restore();if(b.series.pie.label.show){return M()}else{return true}function P(T,R,S){if(T<=0||isNaN(T)){return}if(S){u.fillStyle=R}else{u.strokeStyle=R;u.lineJoin="round"}u.beginPath();if(Math.abs(T-Math.PI*2)>1e-9){u.moveTo(0,0)}u.arc(0,0,L,Q,Q+T/2,false);u.arc(0,0,L,Q+T/2,Q+T,false);u.closePath();Q+=T;if(S){u.fill()}else{u.stroke()}}function M(){var U=O;var R=b.series.pie.label.radius>1?b.series.pie.label.radius:m*b.series.pie.label.radius;for(var T=0;T<H.length;++T){if(H[T].percent>=b.series.pie.label.threshold*100){if(!S(H[T],U,T)){return false}}U+=H[T].angle}return true;function S(ah,aa,Y){if(ah.data[0][1]==0){return true}var aj=b.legend.labelFormatter,ai,W=b.series.pie.label.formatter;if(aj){ai=aj(ah.label,ah)}else{ai=ah.label}if(W){ai=W(ai,ah)}var ab=((aa+ah.angle)+aa)/2;var ag=s+Math.round(Math.cos(ab)*R);var ae=n+Math.round(Math.sin(ab)*R)*b.series.pie.tilt;var X="<span class='pieLabel' id='pieLabel"+Y+"' style='position:absolute;top:"+ae+"px;left:"+ag+"px;'>"+ai+"</span>";A.append(X);var af=A.children("#pieLabel"+Y);var V=(ae-af.height()/2);var Z=(ag-af.width()/2);af.css("top",V);af.css("left",Z);if(0-V>0||0-Z>0||E-(V+af.height())<0||C-(Z+af.width())<0){return false}if(b.series.pie.label.background.opacity!=0){var ac=b.series.pie.label.background.color;if(ac==null){ac=ah.color}var ad="top:"+V+"px;left:"+Z+"px;";c("<div class='pieLabelBackground' style='position:absolute;width:"+af.width()+"px;height:"+af.height()+"px;"+ad+"background-color:"+ac+";'></div>").css("opacity",b.series.pie.label.background.opacity).insertBefore(af)}return true}}}}function y(B){if(b.series.pie.innerRadius>0){B.save();var C=b.series.pie.innerRadius>1?b.series.pie.innerRadius:m*b.series.pie.innerRadius;B.globalCompositeOperation="destination-out";B.beginPath();B.fillStyle=b.series.pie.stroke.color;B.arc(0,0,C,0,Math.PI*2,false);B.fill();B.closePath();B.restore();B.save();B.beginPath();B.strokeStyle=b.series.pie.stroke.color;B.arc(0,0,C,0,Math.PI*2,false);B.stroke();B.closePath();B.restore()}}function p(E,F){for(var G=false,D=-1,B=E.length,C=B-1;++D<B;C=D){((E[D][1]<=F[1]&&F[1]<E[C][1])||(E[C][1]<=F[1]&&F[1]<E[D][1]))&&(F[0]<(E[C][0]-E[D][0])*(F[1]-E[D][1])/(E[C][1]-E[D][1])+E[D][0])&&(G=!G)}return G}function q(J,I){var D=v.getData(),G=v.getOptions(),H=G.series.pie.radius>1?G.series.pie.radius:m*G.series.pie.radius,M,K;for(var T=0;T<D.length;++T){var P=D[T];if(P.pie.show){u.save();u.beginPath();u.moveTo(0,0);u.arc(0,0,H,P.startAngle,P.startAngle+P.angle/2,false);u.arc(0,0,H,P.startAngle+P.angle/2,P.startAngle+P.angle,false);u.closePath();M=J-s;K=I-n;if(u.isPointInPath){if(u.isPointInPath(J-s,I-n)){u.restore();return{datapoint:[P.percent,P.data],dataIndex:0,series:P,seriesIndex:T}}}else{var S=H*Math.cos(P.startAngle),R=H*Math.sin(P.startAngle),E=H*Math.cos(P.startAngle+P.angle/4),B=H*Math.sin(P.startAngle+P.angle/4),N=H*Math.cos(P.startAngle+P.angle/2),L=H*Math.sin(P.startAngle+P.angle/2),V=H*Math.cos(P.startAngle+P.angle/1.5),U=H*Math.sin(P.startAngle+P.angle/1.5),F=H*Math.cos(P.startAngle+P.angle),C=H*Math.sin(P.startAngle+P.angle),Q=[[0,0],[S,R],[E,B],[N,L],[V,U],[F,C]],O=[M,K];if(p(Q,O)){u.restore();return{datapoint:[P.percent,P.data],dataIndex:0,series:P,seriesIndex:T}}}u.restore()}}return null}function r(B){l("plothover",B)}function k(B){l("plotclick",B)}function l(B,H){var C=v.offset();var F=parseInt(H.pageX-C.left);var D=parseInt(H.pageY-C.top);var J=q(F,D);if(b.grid.autoHighlight){for(var E=0;E<i.length;++E){var G=i[E];if(G.auto==B&&!(J&&G.series==J.series)){g(G.series)}}}if(J){j(J.series,B)}var I={pageX:H.pageX,pageY:H.pageY};A.trigger(B,[I,J])}function j(C,D){var B=t(C);if(B==-1){i.push({series:C,auto:D});v.triggerRedrawOverlay()}else{if(!D){i[B].auto=false}}}function g(C){if(C==null){i=[];v.triggerRedrawOverlay()}var B=t(C);if(B!=-1){i.splice(B,1);v.triggerRedrawOverlay()}}function t(D){for(var B=0;B<i.length;++B){var C=i[B];if(C.series==D){return B}}return -1}function x(F,G){var D=F.getOptions();var B=D.series.pie.radius>1?D.series.pie.radius:m*D.series.pie.radius;G.save();G.translate(s,n);G.scale(1,D.series.pie.tilt);for(var E=0;E<i.length;++E){C(i[E].series)}y(G);G.restore();function C(H){if(H.angle<=0||isNaN(H.angle)){return}G.fillStyle="rgba(255, 255, 255, "+D.series.pie.highlight.opacity+")";G.beginPath();if(Math.abs(H.angle-Math.PI*2)>1e-9){G.moveTo(0,0)}G.arc(0,0,B,H.startAngle,H.startAngle+H.angle/2,false);G.arc(0,0,B,H.startAngle+H.angle/2,H.startAngle+H.angle,false);G.closePath();G.fill()}}}var b={series:{pie:{show:false,radius:"auto",innerRadius:0,startAngle:3/2,tilt:1,shadow:{left:5,top:15,alpha:0.02},offset:{top:0,left:"auto"},stroke:{color:"#fff",width:1},label:{show:"auto",formatter:function(f,g){return"<div style='font-size:x-small;text-align:center;padding:2px;color:"+g.color+";'>"+f+"<br/>"+Math.round(g.percent)+"%</div>"},radius:1,background:{color:null,opacity:0},threshold:0},combine:{threshold:-1,color:null,label:"Other"},highlight:{opacity:0.5}}}};c.plot.plugins.push({init:d,options:b,name:"pie",version:"1.1"})})(jQuery);